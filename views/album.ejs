<!-- File: views/album.ejs -->
<!DOCTYPE html>
<html class="dark">
<head>
  <title><%= album.title %> · mee.harshwardhan</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-950 text-white font-sans">
  <%- include('partials/navbar') %>

  <section class="px-6 py-12 max-w-3xl mx-auto">
    <div class="bg-gray-800 rounded-xl p-6 shadow-lg">
      <img src="<%= album.coverImage %>" class="rounded-lg w-full h-64 object-cover mb-6">
      <h1 class="text-3xl font-bold text-sky-400 mb-2"><%= album.title %></h1>
      <p class="text-gray-400 text-sm mb-4"><%= album.genre %> · <%= album.artist %></p>
      <p class="text-gray-300 mb-6"><%= album.description %></p>

      <div class="flex justify-between items-center mb-3">
        <button onclick="likeAlbum('<%= album._id %>')" class="text-pink-400 hover:text-pink-300">❤️ <span id="likes-<%= album._id %>"><%= album.likes %></span></button>
        <span class="text-xs text-gray-500">Plays: <%= album.playCount %></span>
      </div>

      <audio controls class="w-full rounded-md" onplay="countPlay('<%= album._id %>')">
        <% album.audioFiles.forEach(file => { %>
          <source src="<%= file %>" type="audio/mp3">
        <% }) %>
      </audio>
    </div>
  </section>

  <%- include('partials/footer') %>

  <script>
    async function likeAlbum(id) {
      await fetch(`/albums/${id}/like`, { method: 'POST' });
      const el = document.getElementById(`likes-${id}`);
      el.innerText = parseInt(el.innerText) + 1;
    }
    async function countPlay(id) {
      await fetch(`/albums/${id}/play`, { method: 'POST' });
    }
  </script>
</body>
</html>
